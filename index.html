<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RuneQuest NPC Generator & Combat Tracker</title>
  <style>
    body {
      margin: 0; padding: 0;
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      background-color: #1e1e1e;
      padding: 2em;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      max-width: 700px;
      width: 100%;
      text-align: center;
    }
    h1 {
      margin-bottom: 1em;
      color: #00bfff;
    }
    button {
      margin: 10px 0 20px;
      padding: 0.75em;
      font-size: 1em;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      width: 100%;
      max-width: 200px;
    }
    button:hover {
      background-color: #005fa3;
    }
    input[type=number], input[type=text] {
      background-color: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 0.5em;
      font-size: 1em;
      text-align: center;
      margin-bottom: 10px;
      width: 100%;
      max-width: 150px;
    }
    .npc-block {
      background-color: #111;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 25px;
      text-align: center;
    }
    .npc-block h2 {
      margin-top: 0;
      color: #00bfff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 6px;
      border: 1px solid #333;
      font-size: 13px;
    }
    th {
      background-color: #222;
    }
    td input[type=number], td input[type=text] {
      width: 60px;
      margin: 0 auto;
      display: block;
    }
    .section-title {
      margin-top: 15px;
      font-weight: bold;
      color: #cccccc;
      border-bottom: 1px solid #444;
      padding-bottom: 0.25em;
      margin-bottom: 10px;
      text-align: left;
    }
    label.cr-label {
      font-weight: bold;
      color: #ccc;
      display: block;
      margin-bottom: 5px;
      max-width: 150px;
      margin-left: auto;
      margin-right: auto;
    }
    .weapon-shield-table {
      margin-top: 15px;
      width: 100%;
    }
    .weapon-shield-table th, .weapon-shield-table td {
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RuneQuest NPC Generator & Combat Tracker</h1>
    <button onclick="addNPC()">Add New NPC</button>
    <div id="npcContainer"></div>
  </div>

  <script>
    let npcCount = 0;

    function addNPC() {
      npcCount++;
      const id = npcCount;
      const container = document.getElementById('npcContainer');

      const npcHTML = `
        <div class="npc-block" id="npc${id}">
          <h2>NPC #${id}</h2>
          <label class="cr-label" for="cr${id}">Character Rating (CR 0â€“10):</label>
          <input type="number" id="cr${id}" min="0" max="10" value="4" onchange="generateNPCStats(${id})" />
          
          <div id="npcStats${id}"></div>

          <label for="totalHP${id}" class="cr-label">Total Hit Points:</label>
          <input type="number" id="totalHP${id}" min="1" value="12" onchange="updateHitLocations(${id})" />

          <table>
            <thead>
              <tr><th>Location</th><th>Roll</th><th>Total HP</th><th>Current HP</th></tr>
            </thead>
            <tbody>
              ${createLocationRow(id, 'Right Leg', '1-4')}
              ${createLocationRow(id, 'Left Leg', '5-8')}
              ${createLocationRow(id, 'Abdomen', '9-11')}
              ${createLocationRow(id, 'Chest', '12')}
              ${createLocationRow(id, 'Right Arm', '13-15')}
              ${createLocationRow(id, 'Left Arm', '16-18')}
              ${createLocationRow(id, 'Head', '19-20')}
            </tbody>
          </table>

          <div class="section-title">Weapons & Shield</div>
          <table class="weapon-shield-table">
            <thead>
              <tr><th>Item</th><th>Durability (Total HP)</th><th>Current HP</th></tr>
            </thead>
            <tbody>
              <tr>
                <td><input type="text" id="weapon1Name${id}" placeholder="Weapon 1 Name" /></td>
                <td><input type="number" id="weapon1Total${id}" min="0" value="10" onchange="syncCurrentMax(this)" /></td>
                <td><input type="number" id="weapon1Current${id}" min="0" value="10" /></td>
              </tr>
              <tr>
                <td><input type="text" id="weapon2Name${id}" placeholder="Weapon 2 Name" /></td>
                <td><input type="number" id="weapon2Total${id}" min="0" value="10" onchange="syncCurrentMax(this)" /></td>
                <td><input type="number" id="weapon2Current${id}" min="0" value="10" /></td>
              </tr>
              <tr>
                <td><input type="text" id="shieldName${id}" placeholder="Shield Name" /></td>
                <td><input type="number" id="shieldTotal${id}" min="0" value="15" onchange="syncCurrentMax(this)" /></td>
                <td><input type="number" id="shieldCurrent${id}" min="0" value="15" /></td>
              </tr>
            </tbody>
          </table>

          <input type="text" class="status" placeholder="Status (e.g., Injured, Bleeding)" id="status${id}" style="margin-top:12px; width: 100%; max-width: 300px;" />
        </div>
      `;

      container.insertAdjacentHTML('beforeend', npcHTML);

      generateNPCStats(id);
    }

    function createLocationRow(id, label, roll) {
      const part = label.replace(/\s+/g, '');
      return `
        <tr>
          <td>${label}</td>
          <td>${roll}</td>
          <td><input type="text" id="${part}Total${id}" readonly></td>
          <td><input type="number" id="${part}Current${id}" step="1" min="0"></td>
        </tr>
      `;
    }

    function generateNPCStats(id) {
      const crInput = document.getElementById(`cr${id}`);
      let cr = parseInt(crInput.value);
      if (isNaN(cr) || cr < 0) cr = 0;
      if (cr > 10) cr = 10;
      crInput.value = cr;

      const characteristic = 10 + cr;
      const totalHP = characteristic;
      const baseSkill = 20 + (cr * 10);
      const perLocHP = Math.ceil(totalHP / 3);
      const hpChest = perLocHP + 1;
      const hpArms = perLocHP - 1;
      const hpOther = perLocHP;
      const strikeRank = 5 - Math.floor((cr - 1) / 2);
      const damageBonus = cr <= 5 ? "1D4" : "1D6";
      const magicPoints = cr;

      const statsDiv = document.getElementById(`npcStats${id}`);
      statsDiv.innerHTML = `
        <div class="section-title">Characteristics & Combat</div>
        <p><strong>Characteristic Scores:</strong> ${characteristic} (all stats)</p>
        <p><strong>Base Skill:</strong> ~${baseSkill}%</p>
        <p><strong>Strike Rank:</strong> ${strikeRank}</p>
        <p><strong>Damage Bonus:</strong> +${damageBonus}</p>
        <p><strong>Magic Points:</strong> ${magicPoints}</p>
        <div class="section-title">Hit Points by Location</div>
        <p>Legs: ${hpOther} HP</p>
        <p>Abdomen: ${hpOther} HP</p>
        <p>Chest: ${hpChest} HP</p>
        <p>Arms: ${hpArms} HP</p>
        <p>Head: ${hpOther} HP</p>
      `;

      // Update total HP input and hit locations
      document.getElementById(`totalHP${id}`).value = totalHP;
      updateHitLocations(id, hpChest, hpArms, hpOther);
    }

    function updateHitLocations(id, hpChest=null, hpArms=null, hpOther=null) {
      if (hpChest === null || hpArms === null || hpOther === null) {
        const totalHP = parseInt(document.getElementById(`totalHP${id}`).value);
        const perLocHP = Math.ceil(totalHP / 3);
        hpChest = perLocHP + 1;
        hpArms = perLocHP - 1;
        hpOther = perLocHP;
      }

      document.getElementById(`RightLegTotal${id}`).value = hpOther;
      document.getElementById(`LeftLegTotal${id}`).value = hpOther;
      document.getElementById(`AbdomenTotal${id}`).value = hpOther;
      document.getElementById(`ChestTotal${id}`).value = hpChest;
      document.getElementById(`RightArmTotal${id}`).value = hpArms;
      document.getElementById(`LeftArmTotal${id}`).value = hpArms;
      document.getElementById(`HeadTotal${id}`).value = hpOther;

      ['RightLeg', 'LeftLeg', 'Abdomen', 'Chest', 'RightArm', 'LeftArm', 'Head'].forEach(loc => {
        const currentInput = document.getElementById(`${loc}Current${id}`);
        const totalInput = document.getElementById(`${loc}Total${id}`);
        if (!currentInput.value || parseInt(currentInput.value) > parseInt(totalInput.value)) {
          currentInput.value = totalInput.value;
        }
        currentInput.max = totalInput.value;
      });
    }

    // Ensure Current HP never exceeds Total when Total is adjusted (for weapons/shield)
    function syncCurrentMax(totalInput) {
      const id = totalInput.id.match(/\d+$/)[0];
      const baseId = totalInput.id.replace(/\d+$/, '');
      const currentInput = document.getElementById(baseId + 'Current' + id);
      const totalVal = parseInt(totalInput.value);
      if (isNaN(totalVal) || totalVal < 0) {
        totalInput.value = 0;
        currentInput.value = 0;
        currentInput.max = 0;
        return;
      }
      currentInput.max = totalVal;
      if (!currentInput.value || parseInt(currentInput.value) > totalVal) {
        currentInput.value = totalVal;
      }
    }

    // Add initial NPC on load
    addNPC();
  </script>
</body>
</html>
